<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hezae.skylineservice.mapper.FileMapper">


    <!-- 根据文件路径、文件名、文件类型和用户UserId查询文件 -->
    <select id="selectFileByPathAndFileNameAndTypeAndUserId" resultType="com.hezae.skylineservice.model.File">
        SELECT * FROM files
        WHERE file_path = #{filePath}
          AND file_name = #{name}
          AND file_type = #{type}
          AND owner_id = #{userId}
    </select>

    <!-- //根据用户的id查询根目录所有文件-->
    <select id="selectRootDirByUser" resultType="com.hezae.skylineservice.model.File">
        SELECT * FROM files
        WHERE owner_id = #{userId}
          AND file_path =#{username}
    </select>
    <!-- //根据用户的id查询目录所有文件-->
    <select id="selectFileDirByUser" resultType="com.hezae.skylineservice.model.File">
        SELECT * FROM files
        WHERE owner_id = #{userId}
          AND file_path= #{filePath}
    </select>
     <!-- //根据用户的id查询目录所有文件夹，用于网盘上传文件地址选择-->
      <select id="selectFileFolderByUser" resultType="com.hezae.skylineservice.model.File">
        SELECT * FROM files
        WHERE owner_id = #{userId}
          AND file_path= #{filePath}
          AND file_type = concat('Folder')

      </select>

    <select id="selectFileByUser" resultType="com.hezae.skylineservice.model.File">
        SELECT * FROM files
        WHERE owner_id = #{userId}
          AND file_path=  CONCAT(#{filePath}, '%');
    </select>

    <!-- 插入文件记录 -->
    <insert id="addFile" parameterType="com.hezae.skylineservice.model.File">
    INSERT INTO files(
                file_uuid,
                file_path,
                file_name,
                file_type,
                file_size,
                parent_folder_id,
                download_count,
                file_status,
                upload_time,
                modification_time,
                access_permissions,
                description,
                owner_id
            ) VALUES (
                         #{UUid},
                         #{filePath},
                         #{fileName},
                         #{fileType},
                         #{fileSize},
                         #{parentFolderId},
                         #{downloadCount},
                         #{fileStatus},
                         #{uploadTime},
                         #{modificationTime},
                         #{accessPermissions},
                         #{description},
                         #{ownerId}
                     )
</insert>


    <!-- 其他SQL语句... -->

    <!-- 关联映射示例（假设UserMapper有一个根据ID查询User的方法） -->
    <resultMap id="fileResultMap" type="com.hezae.skylineservice.model.File">
        <id property="id" column="id"/>
        <!-- 其他属性映射... -->
        <association property="owner" column="owner_id" javaType="com.hezae.skylineservice.model.User"
                     select="com.hezae.skylineservice.model.UserMapper.selectUserById"/>
    </resultMap>

</mapper>